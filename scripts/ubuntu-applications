#!/usr/bin/env bash

set -e

junk_applications=(
    "gnome-boxes"
    "gnome-calendar"
    "gnome-clocks"
    "gnome-contacts"
    "gnome-maps"
    "gnome-text-editor"
    "gnome-tour"
    "gnome-weather"
    "rhythmbox"
    "simple-scan"
    "yelp"
)

apt_applications=(
    ("gnome-shell-extension-manager" "")
    ("gnome-shell-extensions" "")
    ("gnome-tweaks" "")
    ("ulauncher" "ppa:agornostal/ulauncher")
)

flatpak_applications=(
    "com.jetbrains.IntelliJ-IDEA-Ultimate"
    "com.slack.Slack"
    "com.spotify.Client"
    "org.mozilla.firefox"
    "org.videolan.VLC"
)

for package in "${junk_applications[@]}"; do
    sudo apt remove -y "$package"
done

sudo apt update && sudo apt upgrade -y

for app in "${apt_applications[@]}"; do
    name=${app[0]}
    repo=${app[1]}
    if [ -n "$repo" ]; then
        sudo add-apt-repository -y "$repo"
    fi
    sudo apt install -y "$name"
done

if ! command -v brew >/dev/null 2>&1; then
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

if [ -f "$HOME/Brewfile" ]; then
    brew bundle
fi

if ! command -v flatpak &> /dev/null; then
    sudo apt install -y flatpak
    flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
fi

for app in "${flatpak_applications[@]}"; do
    flatpak install -y flathub "$app"
done

sudo apt autoremove -y

echo "Done"