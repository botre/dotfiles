#!/usr/bin/env bash

set -e

# Check if inside a Git repository
if ! git rev-parse --is-inside-work-tree &>/dev/null; then
    echo "Not inside a Git repository. Aborting." >&2
    exit 1
fi

# Auto-detect whether to use main/master
default_branch=$(git symbolic-ref --short HEAD)
default_branch=${default_branch:-master}

# List merged branches except the current branch
git branch --merged "$default_branch" | grep -vE '^\*|\s*'"$default_branch"'$' | sed 's/^[ *]*//' || {
    echo "No branches found to clean."
    exit 0
}

echo "Use 'git-clean-branches | xargs git branch -d' to actually delete these." >&2
